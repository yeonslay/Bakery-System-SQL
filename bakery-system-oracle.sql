DROP TABLE BREAD CASCADE CONSTRAINT;
DROP TABLE CUSTOMER CASCADE CONSTRAINT;
DROP TABLE ORDER_LIST CASCADE CONSTRAINT;

-- 테이블 생성
CREATE TABLE BREAD (
    BREAD_ID CHAR(10) PRIMARY KEY,
    BREAD_NAME VARCHAR2(50),   
    MADE_DATE DATE DEFAULT SYSDATE, 
    COST NUMBER CHECK (COST > 0) 
);

CREATE TABLE CUSTOMER (
    CUSTOMER_ID CHAR(5) PRIMARY KEY,
    CUSTOMER_NAME VARCHAR2(20),  
    AGE NUMBER
);

CREATE TABLE ORDER_LIST (
    ORDER_ID CHAR(15) PRIMARY KEY,   
    CUSTOMER_ID CHAR(5) REFERENCES CUSTOMER (CUSTOMER_ID), 
    BREAD_ID CHAR(10) REFERENCES BREAD (BREAD_ID),        
    ORDER_DATE DATE DEFAULT SYSDATE    
);

-- 데이터 삽입
-- BREAD 테이블 데이터 삽입
INSERT INTO BREAD (BREAD_ID, BREAD_NAME, MADE_DATE, COST) VALUES ('B001', '크루아상', SYSDATE - 10, 3000);
INSERT INTO BREAD (BREAD_ID, BREAD_NAME, MADE_DATE, COST) VALUES ('B002', '베이글', SYSDATE - 9, 2500);
INSERT INTO BREAD (BREAD_ID, BREAD_NAME, MADE_DATE, COST) VALUES ('B003', '바게트', SYSDATE - 8, 3500);
INSERT INTO BREAD (BREAD_ID, BREAD_NAME, MADE_DATE, COST) VALUES ('B004', '사워도우', SYSDATE - 7, 4000);
INSERT INTO BREAD (BREAD_ID, BREAD_NAME, MADE_DATE, COST) VALUES ('B005', '치아바타', SYSDATE - 6, 4500);
INSERT INTO BREAD (BREAD_ID, BREAD_NAME, MADE_DATE, COST) VALUES ('B006', '포카치아', SYSDATE - 5, 2800);
INSERT INTO BREAD (BREAD_ID, BREAD_NAME, MADE_DATE, COST) VALUES ('B007', '호밀빵', SYSDATE - 4, 3200);

-- CUSTOMER 테이블 데이터 삽입
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C001', '김철수', 25);
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C002', '박영희', 32);
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C003', '이민호', 28);
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C004', '최수지', 24);
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C005', '정다혜', 30);
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C006', '한지민', 26);
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C007', '유재석', 40);
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C008', '강호동', 42);
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C009', '신동엽', 38);
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) VALUES ('C010', '이효리', 35);

-- ORDER_LIST 테이블 데이터 삽입
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O001', 'C001', 'B001', SYSDATE - 7);
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O002', 'C002', 'B002', SYSDATE - 6);
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O003', 'C003', 'B003', SYSDATE - 5);
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O004', 'C004', 'B004', SYSDATE - 4);
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O005', 'C005', 'B005', SYSDATE - 3);
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O006', 'C006', 'B006', SYSDATE - 2);
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O007', 'C007', 'B007', SYSDATE - 1);
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O008', 'C008', 'B001', SYSDATE - 6);
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O009', 'C009', 'B002', SYSDATE - 5);
INSERT INTO ORDER_LIST (ORDER_ID, CUSTOMER_ID, BREAD_ID, ORDER_DATE) VALUES ('O010', 'C010', 'B003', SYSDATE - 4);

SELECT * FROM BREAD; 
SELECT * FROM CUSTOMER;
SELECT * FROM ORDER_LIST;

-- 1. 빵이름이 '바게트'인 빵의 가격을 찾아라.
SELECT COST FROM BREAD
WHERE BREAD_NAME='바게트';

-- 2. 3000원이상 4000원 이하인 빵의 이름을 출력하시오.
SELECT BREAD_NAME FROM BREAD
WHERE COST>=3000 AND COST<=4000;

-- 3. 고객의 성만 나오고 나머지는 * 로 표시하시오. (별칭은 개인정보)
SELECT CUSTOMER_ID, CONCAT(SUBSTR(CUSTOMER_NAME,1, LENGTH(CUSTOMER_NAME)-2),'**') AS 개인정보
FROM CUSTOMER;

-- 4. 고객을 4개의 그룹으로 나누시오.(ROWNUM을 활용할 것, 별칭은 그룹으로 할 것)
SELECT CUSTOMER_ID, CUSTOMER_NAME, AGE, MOD(ROWNUM, 4) AS 그룹
FROM CUSTOMER;

-- 5. 나이가 30이상이면 OB로 30미만이면 YB로 해서 AGE_GROUP이라는 열을 추가하시오.
SELECT CUSTOMER_ID, CUSTOMER_NAME, AGE,
CASE 
    WHEN AGE >= 30 THEN 'OB'
    ELSE 'YB'
END AS "AGE_GROUP"
FROM CUSTOMER;

--6. BREAD 테이블에 INCREASED_COST 라는 열을 추가하고 값은 COST에 500을 더한 값으로 채워넣으시오.
ALTER TABLE BREAD ADD INCREASED_COST NUMBER;
UPDATE BREAD
SET INCREASED_COST = COST + 500;
SELECT * FROM BREAD;

-- 7. BREAD테이블 MADE_DATE열에서 DAY만 추출하시오.
SELECT BREAD_ID, BREAD_NAME, EXTRACT(DAY FROM MADE_DATE), COST
FROM BREAD;

-- 8. BREAD테이블의 COST데이터 뒤에 '원'을 붙이시오.
SELECT BREAD_ID, BREAD_NAME, MADE_DATE, CONCAT(COST ,'원')
FROM BREAD;

-- 9. (C011, '홍길동', 29) 이 데이터를 추가하고 SAVEPOINT A1을 설정하시오.
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, AGE) 
VALUES ('C011', '홍길동', 29);
SELECT * FROM CUSTOMER;
SAVEPOINT A1;

-- 10. ROLLBACK을 수행하시오.
ROLLBACK;
SELECT * FROM CUSTOMER;

